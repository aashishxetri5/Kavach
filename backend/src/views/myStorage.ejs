<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Storage</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <style>
      body {
        font-size: 18px;
        background-color: #f1f3f4;
      }
      a {
        text-decoration: none;
        color: #202124;
      }
      ul {
        list-style-type: none;
        padding: 0;
        margin: 0 1rem;
      }

      .topbar {
        width: 100%;
        height: 70px;
        background-color: #fff;
        /* box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px; */
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 2rem;
      }

      .logo {
        height: 50px;
        width: 50px;
      }

      .logo img {
        height: 100%;
        width: 100%;
        aspect-ratio: 1 / 1;
        object-fit: contain;
      }

      .newbtn {
        padding-left: 1.5rem;
      }
      .newbtn button {
        background-color: #1a73e8;
        color: aliceblue;
        padding: 10px 20px;
      }
      .linkitem {
        padding: 5px 0;
        padding-left: 1rem;
      }
      .linkitem a {
        display: flex;
        align-items: center;
      }
      .linkitem:hover {
        background-color: #f1f3f4;
      }
      .sidemenu {
        width: 20%;
      }
      .maincontent {
        width: calc(80% - 0.5rem);
      }
      .sidemenu,
      .maincontent {
        height: calc(100vh - 80px);
        background-color: #fff;
        box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
      }
    </style>
  </head>
  <body>
    <div class="topbar">
      <div class="logo">
        <a href="/">
          <img src="/img/kavach-logo.png" alt="logo" />
        </a>
      </div>
      <div class="searchbar">
        <form action="/search">
          <input type="text" name="search" placeholder="Search" />
        </form>
      </div>
      <div class="right"></div>
    </div>

    <div class="wrapper d-flex flex-col gap-1">
      <div class="sidemenu pt-5 rounded mt-1">
        <div class="newbtn">
          <button
            type="button"
            class="btn btn-primary btn d-flex align-items-center"
            data-bs-toggle="modal"
            data-bs-target="#newFileUpload"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              focusable="false"
              fill="currentColor"
            >
              <path d="M20 13h-7v7h-2v-7H4v-2h7V4h2v7h7v2z"></path>
            </svg>

            <h2 class="fs-5 mb-0">New</h2>
          </button>
        </div>

        <div
          class="modal fade"
          id="newFileUpload"
          data-bs-backdrop="static"
          data-bs-keyboard="false"
          tabindex="-1"
          aria-labelledby="newFileUploadLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h1 class="modal-title fs-5" id="newFileUploadLabel">
                  Upload New File
                </h1>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>

              <form
                action="/newfile"
                method="post"
                enctype="multipart/form-data"
              >
                <div class="modal-body">
                  <div class="mb-3">
                    <label for="file" class="form-label">Select File</label>
                    <input
                      type="file"
                      class="form-control"
                      id="file"
                      name="file"
                      accept=".pdf, .txt"
                      required
                    />
                  </div>
                </div>

                <div class="modal-footer">
                  <button type="submit" class="btn btn-primary">Upload</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <aside class="menu mt-4">
          <ul class="list-style-none">
            <li class="linkitem">
              <a href="#">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                >
                  <path
                    fill="black"
                    d="M6 19h3v-6h6v6h3v-9l-6-4.5L6 10zm-2 2V9l8-6l8 6v12h-7v-6h-2v6zm8-8.75"
                  />
                </svg>
                <span class="ms-2">Home</span>
              </a>
            </li>
            <li class="linkitem">
              <a href="#">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                >
                  <path
                    fill="black"
                    d="M13.5 8H12v5l4.28 2.54l.72-1.21l-3.5-2.08zM13 3a9 9 0 0 0-9 9H1l3.96 4.03L9 12H6a7 7 0 0 1 7-7a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.9 8.9 0 0 0 13 21a9 9 0 0 0 9-9a9 9 0 0 0-9-9"
                  />
                </svg>
                <span class="ms-2">Recent</span>
              </a>
            </li>
            <li class="linkitem">
              <a href="#">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                >
                  <path
                    fill="black"
                    d="M14 14.252v2.09A6 6 0 0 0 6 22H4a8 8 0 0 1 10-7.749M12 13c-3.315 0-6-2.685-6-6s2.685-6 6-6s6 2.685 6 6s-2.685 6-6 6m0-2c2.21 0 4-1.79 4-4s-1.79-4-4-4s-4 1.79-4 4s1.79 4 4 4m6.586 6l-1.829-1.828l1.415-1.415L22.414 18l-4.242 4.243l-1.415-1.415L18.586 19H15v-2z"
                  />
                </svg>
                <span class="ms-2">Shared</span>
              </a>
            </li>
            <li class="linkitem">
              <a href="#">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                >
                  <path
                    fill="none"
                    stroke="black"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 7h14m-9 3v8m4-8v8M10 3h4a1 1 0 0 1 1 1v3H9V4a1 1 0 0 1 1-1M6 7h12v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1z"
                  />
                </svg>
                <span class="ms-2">Bin</span>
              </a>
            </li>
          </ul>
        </aside>
      </div>
      <div class="maincontent rounded mt-1">
        <div class="content px-3">
          <div class="title">
            <h1 class="">All Files</h1>
          </div>
          <div class="fileList">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th scope="col">Name</th>
                  <th scope="col">Encrypted</th>
                  <th scope="col">File Type</th>
                  <th scope="col">Date</th>
                  <th scope="col">Download</th>
                </tr>
              </thead>
              <tbody>
                <% if(filesByUser !== undefined) { filesByUser.forEach(file => {
                %>
                <tr>
                  <td style="display: flex; align-items: center; gap: 0.5rem">
                    <img src="/img/<%=file.fileType%>.svg" alt="" srcset="" />
                    <%=file.filename.replace(/\.aes$/, '')%>
                  </td>
                  <td>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="1em"
                      height="1em"
                      viewBox="0 0 24 24"
                    >
                      <path
                        fill="black"
                        d="M12 17a2 2 0 0 1-2-2c0-1.11.89-2 2-2a2 2 0 0 1 2 2a2 2 0 0 1-2 2m6 3V10H6v10zm0-12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V10c0-1.11.89-2 2-2h1V6a5 5 0 0 1 5-5a5 5 0 0 1 5 5v2zm-6-5a3 3 0 0 0-3 3v2h6V6a3 3 0 0 0-3-3"
                      />
                    </svg>
                  </td>
                  <td><%=file.fileType%></td>
                  <td>
                    <%=new Date(file.createdAt).toLocaleDateString('en-NP', {
                    day: 'numeric', month: 'numeric', year: 'numeric'}); %>
                  </td>
                  <td>
                    <a href="/download/<%=file._id%>" target="_blank">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="1em"
                        height="1em"
                        viewBox="0 0 24 24"
                      >
                        <path
                          fill="none"
                          stroke="black"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="1.5"
                          d="M6 20h12M12 4v12m0 0l3.5-3.5M12 16l-3.5-3.5"
                        />
                      </svg>
                    </a>
                  </td>
                </tr>
                <% }); } %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
